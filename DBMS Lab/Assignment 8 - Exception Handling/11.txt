SET SERVEROUTPUT ON;


-- Write a PL/SQL block to handle the following exceptions:
-- 1. For the given receipt number, if there are no rows then display as “No order with the
-- given receipt <number>”. If the receipt contains more than one item, display as
-- “The given receipt <number> contains more than one item”. If the receipt contains
-- single item, display as “The given receipt <number> contains exactly one item”. Use
-- predefined exception handling.

SELECT * FROM ITEM_LIST WHERE RNO=18129;


       RNO    ORDINAL ITEM           
---------- ---------- ---------------
     18129          1 70-TU    


DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;
    
BEGIN
    RNO_INPUT:='&RECEIPT_NO_INPUT';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;
/      

old:DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;

BEGIN
    RNO_INPUT:='&RECEIPT_NO_INPUT';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;

new:DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;

BEGIN
    RNO_INPUT:='18129';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;
THE GIVEN RECEIPT 18129 CONTAINS EXACTLY ONE ITEM


PL/SQL procedure successfully completed.


SELECT * FROM ITEM_LIST WHERE RNO=85858;

       RNO    ORDINAL ITEM           
---------- ---------- ---------------
     85858          1 20-CA-7.5      
     85858          2 70-M-VA-SM-DZ  
     85858          3 51-BLU         

DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;
    
BEGIN
    RNO_INPUT:='&RECEIPT_NO_INPUT';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;
/


old:DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;

BEGIN
    RNO_INPUT:='&RECEIPT_NO_INPUT';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;

new:DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;

BEGIN
    RNO_INPUT:='85858';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;
THE GIVEN RECEIPT 85858 CONTAINS MORE THAN ONE ITEM


PL/SQL procedure successfully completed.

SELECT * FROM ITEM_LIST WHERE RNO=11111;

no rows selected

DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;
    
BEGIN
    RNO_INPUT:='&RECEIPT_NO_INPUT';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;
/

old:DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;

BEGIN
    RNO_INPUT:='&RECEIPT_NO_INPUT';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;

new:DECLARE
    RNO_INPUT ITEM_LIST.RNO%TYPE;
    CURSOR ITEM_LIST_CURSOR IS SELECT * FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    ITEM_LIST_ROW ITEM_LIST_CURSOR%ROWTYPE;

BEGIN
    RNO_INPUT:='11111.';
    OPEN ITEM_LIST_CURSOR;
    FETCH ITEM_LIST_CURSOR INTO ITEM_LIST_ROW;
    CLOSE ITEM_LIST_CURSOR;
    SELECT * INTO ITEM_LIST_ROW FROM ITEM_LIST WHERE RNO=RNO_INPUT;
    DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS EXACTLY ONE ITEM');
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO ORDER WITH THE GIVEN RECEIPT '||RNO_INPUT);
    WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE('THE GIVEN RECEIPT '||RNO_INPUT||' CONTAINS MORE THAN ONE ITEM');
END;
NO ORDER WITH THE GIVEN RECEIPT 11111


PL/SQL procedure successfully completed.



-- 2. While inserting the receipt details, raise an exception when the receipt date is greater
-- than the current date.

SET SERVEROUTPUT ON;
desc receipts;

Name  Null?    Type   
----- -------- ------ 
RNO   NOT NULL NUMBER 
RDATE          DATE   
CID            NUMBER 


CREATE OR REPLACE TRIGGER CHECKINSDATE
BEFORE INSERT ON RECEIPTS FOR EACH ROW

DECLARE
    THROWEXCEPTION EXCEPTION;
    TODAYDATE DATE;
BEGIN
    SELECT SYSDATE INTO TODAYDATE FROM DUAL;
    IF(:NEW.RDATE>TODAYDATE) THEN
        RAISE THROWEXCEPTION; 
    END IF;

EXCEPTION
    WHEN THROWEXCEPTION THEN
        RAISE_APPLICATION_ERROR(-20009,'RECEIPT DATE GREATER THAN TODAYDATE');
END;
/

Trigger CHECKINSDATE compiled

INSERT INTO RECEIPTS VALUES(11111,'22-May-2023',10);


Error starting at line : 21 in command -
INSERT INTO RECEIPTS VALUES(11111,'22-May-2023',10)
Error report -
ORA-20009: RECEIPT DATE GREATER THAN TODAYDATE
ORA-06512: at "SYSTEM.CHECKINSDATE", line 12
ORA-04088: error during execution of trigger 'SYSTEM.CHECKINSDATE'

INSERT INTO RECEIPTS VALUES(11111,'25-May-2022',10);


Error starting at line : 22 in command -
INSERT INTO RECEIPTS VALUES(11111,'25-May-2022',10)
Error report -
ORA-00001: unique constraint (SYSTEM.RNO_PKEY) violated